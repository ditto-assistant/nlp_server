CREATE TABLE IF NOT EXISTS users(
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR NOT NULL,
    ditto_unit_url VARCHAR
);

INSERT INTO
    users (username, ditto_unit_url)
SELECT
    'user1',
    'http://localhost:42032'
WHERE
    NOT EXISTS (
        SELECT
            1
        FROM
            users
    );

CREATE TABLE IF NOT EXISTS chats(
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp NOT NULL,
    conv_id id,
    prompt VARCHAR NOT NULL,
    response VARCHAR
);

CREATE TABLE IF NOT EXISTS conversations(
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id id,
    created_at timestamp NOT NULL,
    updated_at timestamp,
    viewed_at timestamp NOT NULL
);

INSERT INTO
    conversations(user_id, created_at, viewed_at)
SELECT
    1,
    datetime('now'),
    datetime('now')
WHERE
    NOT EXISTS (
        SELECT
            1
        FROM
            conversations
    );

CREATE TABLE IF NOT EXISTS migrations(
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR NOT NULL,
    executed_at timestamp NOT NULL
);

INSERT INTO
    migrations (name, executed_at)
SELECT
    'create_tables',
    datetime('now')
WHERE
    NOT EXISTS (
        SELECT
            1
        FROM
            migrations
        WHERE
            name = 'create_tables'
            AND id = 1
    );